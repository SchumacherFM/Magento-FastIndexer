<!DOCTYPE HTML>
<html lang="en-US" manifest="./manifest.appcache">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Introduction | FastIndexer for Magento 1</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="SchumacherFM">
        <meta name="description" content="Indexes your Magneto store in 0.0003 seconds ;-)">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="./doc/about/README.html" />
        
        

        <meta property="og:title" content="Introduction | FastIndexer for Magento 1">
        <meta property="og:site_name" content="FastIndexer for Magento 1">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/SchumacherFM">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="gitbook/style.css">
        


        
    <div class="book" data-github="SchumacherFM/magento-fastindexer" data-level="0" data-basepath="." data-revision="1399459624834">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/SchumacherFM/magento-fastindexer" target="_blank" class="btn pull-left"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>
    

    
    <a href="https://github.com/SchumacherFM/magento-fastindexer/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/SchumacherFM/magento-fastindexer/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="./" >FastIndexer for Magento 1</a>
    </h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/SchumacherFM" target="blank">About the author</a>
        </li>
        

        
        <li>
            <a href="https://github.com/SchumacherFM/magento-fastindexer/issues" target="blank">Questions and Issues</a>
        </li>
        

        
        <li>
            <a href="https://github.com/SchumacherFM/magento-fastindexer/edit/master/README.md" target="blank">Edit and Contribute</a>
        </li>
        

        
        <li class="divider"></li>
        

        <li data-level="0" data-path="index.html">
            <a href="./"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="doc/about/README.html">
                
                <a href="./doc/about/README.html">
                    <i class="fa fa-check"></i> <b>1.</b> About FastIndexer
                </a>
                
                
            </li>
        
            <li  data-level="2" data-path="doc/config/README.html">
                
                <a href="./doc/config/README.html">
                    <i class="fa fa-check"></i> <b>2.</b> Configuration
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="doc/config/general.html">
                            
                            <a href="./doc/config/general.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> General
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="doc/config/setup.html">
                            
                            <a href="./doc/config/setup.html">
                                <i class="fa fa-check"></i> <b>2.2.</b> Setup
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="doc/config/databases.html">
                            
                            <a href="./doc/config/databases.html">
                                <i class="fa fa-check"></i> <b>2.3.</b> Databases
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" >
                            
                            <span><b>2.4.</b> Code</span>
                            
                        </li>
                    
                        <li  data-level="2.5" >
                            
                            <span><b>2.5.</b> Tables</span>
                            
                        </li>
                    
                </ul>
                
            </li>
        

        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 0%;min-width: 0%;"></div>
    </div>
    <div class="chapters">
    
        <a href="./index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="./doc/about/README.html" title="About FastIndexer" class="chapter  new-chapter" data-progress="1" style="left: 20%;"></a>
    
        <a href="./doc/config/README.html" title="Configuration" class="chapter  new-chapter" data-progress="2" style="left: 40%;"></a>
    
        <a href="./doc/config/general.html" title="General" class="chapter  " data-progress="2.1" style="left: 60%;"></a>
    
        <a href="./doc/config/setup.html" title="Setup" class="chapter  " data-progress="2.2" style="left: 80%;"></a>
    
        <a href="./doc/config/databases.html" title="Databases" class="chapter  " data-progress="2.3" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_1">
                    
                        <h1 id="fastindexer">FastIndexer</h1>
<p>No more empty results in the frontend due to a long taking reindex process!</p>
<ul>
<li>Integrates seamlessly into the existing Magento indexer process.</li>
<li>Does not change the core Magento indexer logic!</li>
<li>Only one class rewrite! (Adding an event in <code>Mage_Index_Model_Process::reindexAll()</code>)</li>
<li>Indexing blocks the frontend for only ~0.003 seconds instead of minutes with the normal indexer.</li>
<li>The frontend will not be affected anymore by any reindex process.</li>
<li>Speeds up some indexing processes of your Magento store. </li>
<li>You can enable or disable the module in the backend and test the speed difference by yourself.</li>
<li>Full reindexing now even under high frontend load possible (Citation/Test needed ... ).</li>
<li>Limits the amount of SQL queries in some cases</li>
<li>Even integrates into your custom indexer processes (theoretically, talk to me).</li>
<li>Indexer (catalogpermissions &amp; targetrule) for Enterprise Edition will also be considered</li>
</ul>
<p>The FastIndexer is only available on the command line.</p>
<pre><code>$ php/hhvm index.php reindexall
</code></pre><h2 id="configuration-options-backend-">Configuration options (Backend)</h2>
<p>Accessible via <em>System -&gt; Configuration -&gt; System -&gt; FastIndexer</em></p>
<h3 id="enable-fastindexer">Enable FastIndexer</h3>
<p>Enable or disable the FastIndexer. This is useful to become yourself aware about the differences.</p>
<h3 id="drop-old-tables">Drop old tables</h3>
<p>Default values: YES. For testing purposes or in development you can disable that option.</p>
<p>Disabling it also means that the process might be a little bit slower and you are collecting tons of data by generating old index tables.</p>
<h3 id="shadow-databases">Shadow Databases</h3>
<p>FastIndexer needs two Shadow Databases which must be on the same file system as the Magento store core database.</p>
<p>You have two text fields in the backend to enter the different names of the Shadow Databases.</p>
<p>The backend configuration section also checks for you if the current Magento core database user can access those two databases. If not it will display a warning. FastIndexer cannot create by itself those two databases automatically. Ask your DevOps for assistance.</p>
<h3 id="verifying-installation-of-pdo-class">Verifying Installation of PDO class</h3>
<p>FastIndexer comes with a custom <code>Pdo_MySQL</code> PHP class which also fixes two evil bugs in the default <code>Varien_Db_Adapter_Pdo_Mysql</code> class. It is 100% compatible.</p>
<p>The FastIndexer PDO class must be configured in <code>app/etc/local.xml</code>.</p>
<p>If you have correctly installed the FastIndexer PDO class then a green sign shows up in the system configuration section otherwise you will see the installation instructions.</p>
<h3 id="url-rewrites-copy-all-custom-urls">URL Rewrites: Copy all custom URLs</h3>
<p>Enable this option if you wish to copy all custom URLs. Before enabling this option be sure that the permanent rewrite generating bug in Magento ~&lt;=1.7 has been fixed. Otherwise you will add tens of thousands useless rewrites with each reindexing. If this option is disabled only the rewrites created by the store maintainer will be copied. But this can be slow because a regular expression will be used to determine all custom rewrites. If set to yes no regex will be used.</p>
<h5 id="checking-for-system-generated-custom-redirect-permanent-urls">Checking for system generated custom redirect permanent URLs</h5>
<p>With the following SQL Query you can check the system generated custom redirect permanent URLs:</p>
<pre><code class="lang-SQL"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-string">`core_url_rewrite`</span> <span class="hljs-keyword">WHERE</span> is_system=<span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> id_path RLIKE <span class="hljs-string">'[0-9]+\_[0-9]+'</span></span>
</code></pre>
<p>If that query returns nothing then you can set this option to <strong>Yes</strong>.</p>
<h5 id="checking-for-your-custom-created-urls">Checking for your custom created URLs</h5>
<p>You can create custom URL redirects at <em>Catalog -&gt; URL Rewrite Management</em>. With the following SQL Query you can check if you have custom URLs:</p>
<pre><code class="lang-SQL"><span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-string">`core_url_rewrite`</span> <span class="hljs-keyword">WHERE</span> is_system=<span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> id_path <span class="hljs-keyword">NOT</span> RLIKE <span class="hljs-string">'[0-9]+\_[0-9]+'</span></span>
</code></pre>
<h2 id="configuration-options-local-xml-">Configuration options (local.xml)</h2>
<h3 id="changing-the-type-instance">Changing the type instance</h3>
<p>Please see the section <em>Verifying Installation of PDO class</em> above.</p>
<h3 id="low-level-optimization">Low Level Optimization</h3>
<p>This feature can be switched on even when FastIndexer is turned off.</p>
<p>Low Level Optimization tries to convert stringified integer or float values into real integer resp. float values. This features applies on all queries. E.g. converts a query from <code>WHERE entity_id IN(&#39;433284&#39;, 433283)</code> to <code>WHERE entity_id IN(433284, 433283)</code> because mixing strings and integer values in a query will <a href="http://www.mysqlperformanceblog.com/2006/09/08/why-index-could-refuse-to-work/" target="_blank">MySQL slow down</a>. Query 1 needs: 0.0566s and optimized 0.0008s.</p>
<p>Use at your own risk. Test thoroughly.</p>
<p>To enable the low level quote() method optimization edit your local.xml and add the following entry in the node: <code>config/global/resources/default_setup/connection/fiQuoteOpt</code>.
Use for node <code>fiQuoteOpt</code> the value 1 for enable or any other value for disabled.</p>
<pre><code>&lt;config&gt;
    &lt;global&gt;
        ...
        &lt;resources&gt;
            ...
            &lt;default_setup&gt;
                &lt;connection&gt;
                    &lt;host&gt;&lt;![CDATA[localhost]]&gt;&lt;/host&gt;
                    &lt;username&gt;...&lt;/username&gt;
                    ...

                    &lt;!--FastIndexer quote() optimization: 1/0--&gt;
                    &lt;fiQuoteOpt&gt;1&lt;/fiQuoteOpt&gt;

                &lt;/connection&gt;
            &lt;/default_setup&gt;
        &lt;/resources&gt;
    &lt;/global&gt;
&lt;/config&gt;
</code></pre><p>It must be set in the local.xml file because quote() method is called even before the Magento configuration is available.</p>
<h2 id="how-do-the-magento-default-indexer-work-full-reindex-">How do the Magento default indexer work? (Full reindex)</h2>
<p>Investigation of the logged SQL statements: Most indexer are completely deleting the index tables. Some of them only for a store view. But both cases are equal because each time the frontend customer has no access to the data (prices, stocks, search results ...) and gets empty results. Lost a customer and made less profit :-(</p>
<h2 id="explaining-the-operation-of-fastindexer">Explaining the operation of FastIndexer</h2>
<p>All index processes have one thing in common: They block the frontend during their whole index duration. That&#39;s why many store owners run a full reindex only during the night or even more seldom.</p>
<p>Some indexer truncates the index tables. If in that moment a potential customer wants to buy something he/she will fail because of empty tables.</p>
<p>Some indexer are doing complex operations for calculating differences between already indexed data and new data. This costs a lot of time and the index tables have a lock for updates.</p>
<h4 id="technial-explanations">Technial Explanations</h4>
<p>Reindexing will be done in the so called Shadow Databases.</p>
<p>Therefore the table swapping operation is done atomically after the reindexing, which means that no other session can access any of the index/flat tables while the swapping is running.</p>
<p>This swapping operation needs <strong>~0.003 seconds</strong>.</p>
<p>If there are any database triggers associated with an index/flat table which is swapped to a different Shadow Database, then the swapping operation will fail.</p>
<p>When the swapping operation is running and there are any locked tables or active transactions then the swapping will fail.</p>
<p><strong>If the swapping fails nothing will break.</strong> Just rerun the indexer.</p>
<p>The current Magento database user must also have the ALTER and DROP privileges on the original table, and the SELECT,ALTER,DROP,CREATE and INSERT privileges on the new tables in the Shadow Databases.</p>
<h2 id="performance">Performance</h2>
<p>On my MacBook Air Mid 2012 tested with the following stores.</p>
<p>Condition for all tests:</p>
<ul>
<li>No load on the frontend. </li>
<li>Just indexing of previous reindexed tables. </li>
<li>All indexe commands ran 3x and the median has been calculated. </li>
<li><code>SET GLOBAL query_cache_type=OFF;</code> has been set.</li>
<li>At the 4th run all queries have been counted in <code>Zend_Db_Statement_Pdo::_execute()</code>.</li>
</ul>
<pre><code>$ time -p php indexer.php --reindex &lt;code&gt;
</code></pre><h3 id="magento-1-8-default-installation">Magento 1.8 default installation</h3>
<ul>
<li>3 store views</li>
<li>27 categories</li>
<li>120 products</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>FastIndexer</th>
<th>real</th>
<th>user</th>
<th>sys</th>
<th>Query Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>reindexall</td>
<td>x</td>
<td>14.209s</td>
<td>5.836s</td>
<td>0.370s</td>
<td>3275</td>
</tr>
<tr>
<td>reindexall</td>
<td>✔︎</td>
<td>7.490s</td>
<td>4.265s</td>
<td>0.179s</td>
<td>2702</td>
</tr>
</tbody>
</table>
<h3 id="shop-03-magento-ee-1-12">Shop 03: Magento EE 1.12</h3>
<ul>
<li>3 store views</li>
<li>66 categories</li>
<li>14088 products</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>FastIndexer</th>
<th>real</th>
<th>user</th>
<th>sys</th>
<th>Query Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>catalog_product_attribute</td>
<td>x</td>
<td>29.69s</td>
<td>8.14s</td>
<td>0.40s</td>
<td>208</td>
</tr>
<tr>
<td>...</td>
<td>✔︎</td>
<td>34.18s</td>
<td>8.39s</td>
<td>0.42s</td>
<td>243</td>
</tr>
<tr>
<td>catalog_product_price</td>
<td>x</td>
<td>10.71s</td>
<td>1.56s</td>
<td>0.07s</td>
<td>173</td>
</tr>
<tr>
<td>...</td>
<td>✔︎</td>
<td>9.64s</td>
<td>1.63s</td>
<td>0.07s</td>
<td>248</td>
</tr>
<tr>
<td>catalog_product_flat</td>
<td>x</td>
<td>184.31s</td>
<td>4.74s</td>
<td>0.58s</td>
<td>1,570</td>
</tr>
<tr>
<td>...</td>
<td>✔︎</td>
<td>167.26s</td>
<td>2.60s</td>
<td>0.11s</td>
<td>530</td>
</tr>
<tr>
<td>catalog_category_flat</td>
<td>x</td>
<td>2.43s</td>
<td>1.84s</td>
<td>0.07s</td>
<td>80</td>
</tr>
<tr>
<td>...</td>
<td>✔︎</td>
<td>2.52s</td>
<td>1.84s</td>
<td>0.07s</td>
<td>113</td>
</tr>
<tr>
<td>catalog_category_product</td>
<td>x</td>
<td>70.37s</td>
<td>1.91s</td>
<td>0.07s</td>
<td>117</td>
</tr>
<tr>
<td>...</td>
<td>✔︎</td>
<td>31.46s</td>
<td>2.09s</td>
<td>0.08s</td>
<td>138</td>
</tr>
<tr>
<td>catalogsearch_fulltext</td>
<td>x</td>
<td>114.91s</td>
<td>2.21s</td>
<td>0.07s</td>
<td>8,769</td>
</tr>
<tr>
<td>...</td>
<td>✔︎</td>
<td>114.24s</td>
<td>2.76s</td>
<td>0.08s</td>
<td>8,774</td>
</tr>
<tr>
<td>cataloginventory_stock</td>
<td>x</td>
<td>3.36s</td>
<td>1.50s</td>
<td>0.06s</td>
<td>32</td>
</tr>
<tr>
<td>...</td>
<td>✔︎</td>
<td>3.16s</td>
<td>1.38s</td>
<td>0.06s</td>
<td>47</td>
</tr>
<tr>
<td>catalog_url  (~245177 URLs)</td>
<td>x</td>
<td>858.11s</td>
<td>637.34s</td>
<td>60.95s</td>
<td>524,748*</td>
</tr>
<tr>
<td>...</td>
<td>✔︎</td>
<td>819.44s</td>
<td>574.90s</td>
<td>53.25s</td>
<td>494,411</td>
</tr>
</tbody>
</table>
<ul>
<li>added 3701 additional URLs due to the rewrite bug in the URL indexer</li>
</ul>
<h3 id="shop-08-magento-ee-1-12">Shop 08: Magento EE 1.12</h3>
<ul>
<li>4 store views</li>
<li>~ 240 categories</li>
<li>~ 5000 products</li>
</ul>
<table>
<thead>
<tr>
<th>Type</th>
<th>FastIndexer</th>
<th>real</th>
<th>user</th>
<th>sys</th>
<th>Query Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>catalog_product_attribute</td>
<td>x</td>
<td>0.00s</td>
<td>0.00s</td>
<td>0.00s</td>
<td>0</td>
</tr>
</tbody>
</table>
<h3 id="shop-26-magento-1-7">Shop 26: Magento 1.7</h3>
<ul>
<li>One store view</li>
<li>~ 15.500 categories</li>
<li>~ 45.400 products</li>
</ul>
<table>
<thead>
<tr>
<th>FastIndexer</th>
<th>real</th>
<th>user</th>
<th>sys</th>
<th>Query Count</th>
</tr>
</thead>
<tbody>
<tr>
<td>Disabled</td>
<td>14m8.919s</td>
<td>5m0.248s</td>
<td>0m9.695s</td>
<td>@todo</td>
</tr>
<tr>
<td>Enabled</td>
<td>10m37.517s</td>
<td>4m51.361s</td>
<td>0m8.864s</td>
<td>@todo</td>
</tr>
</tbody>
</table>
<h2 id="about-history">About/History</h2>
<p>Extension key: SchumacherFM_FastIndexer</p>
<p>Version 1.0.0</p>
<ul>
<li>Initial Release</li>
</ul>
<h2 id="compatibility">Compatibility</h2>
<ul>
<li>Magento CE &gt;= 1.6.2</li>
<li>php &gt;= 5.2.0</li>
</ul>
<p>The FastIndexer will not run with Magento CE &lt; 1.6.2 because elementary events are missing. If you are interested in running FastIndexer with lower Magneto version write me, there is a solution.</p>
<h2 id="support-contribution">Support / Contribution</h2>
<p>Report a bug using the issue tracker.</p>
<h2 id="licence">Licence</h2>
<p>Don&#39;t know. Maybe still closed source but you&#39;ll get it with a donation to <a href="http://www.seashepherd.org/" target="_blank">http://www.seashepherd.org/</a></p>
<h2 id="author">Author</h2>
<p><a href="https://github.com/SchumacherFM" target="_blank">Cyrill Schumacher</a></p>
<p><a href="http://www.schumacher.fm/cyrill.asc" target="_blank">My pgp public key</a></p>
<p>Made in Sydney, Australia :-)</p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        
        <a href="./doc/about/README.html" class="navigation navigation-next navigation-unique"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
        

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
